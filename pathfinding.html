<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Kyle Tseng</title>

        <!-- Bootstrap v5.1 -->
        <!-- https://getbootstrap.com/docs/5.1/getting-started/introduction/ -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <!-- css file -->
        <link href="static/css/main.css" rel="stylesheet">
        <!-- Bootstrap icons -->
        <!-- https://icons.getbootstrap.com -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
        <!-- DM Mono & Ubuntu Fonts -->
        <!-- https://fonts.google.com/ -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300&family=Ubuntu:wght@300&display=swap" rel="stylesheet">
    </head>
    
    <body>
        <!-- Top nav header -->
        <header>
            <!-- Added aria-label since there are top nav and side nav on this page -->
            <nav class="navbar navbar-expand-lg navbar-dark grey bg-color" aria-label="Top menu">
                <div class="container-fluid">
                    <!-- Collapse header and show hamburger button when width is smaller than 992px (Bootstrap) -->
                    <button class="navbar-toggler js-disable" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon grey"></span>
                    </button>
                    <div class="collapse navbar-collapse show" id="navbarNavAltMarkup">
                        <div class="navbar-nav flex-row">
                            <a class="nav-link js-disable-margin" aria-current="page" href="index.html">Main</a>
                            <a class="nav-link active" href="index.html#projects">Projects</a>
                        </div>
                    </div>
                </div>
              </nav>
        </header>
        <main>
            <div class="wrapper">
                <!-- <aside> defines the content as 'related' to the main content, but secondary, to fix the heading structure issue with side nav and main content -->
                <aside>
                    <!-- Side navigation bar -->
                    <nav class="side-nav" aria-label="Side menu">
                        <h1>File Explorer</h1>
                        <a href="#pathfinding"><p class="explorer-title">Pathfinding</p></a>
                        <ul class="nav flex-column"> 
                            <li class="nav-item">
                                <a href="#overview" class="side-nav-link"><p><span class="orange">&lt&gt</span> Overview</p></a>
                            </li>
                            <li class="nav-item">
                                <a href="#learning-points" class="side-nav-link"><p><span class="orange">&lt&gt</span> Learning Points</p></a>
                            </li>   
                            <!-- <li class="nav-item">
                                <a href="#challenges" class="side-nav-link"><p><span class="orange">&lt&gt</span> Challenges</p></a>
                            </li> -->
                            <li class="nav-item">
                                <a href="#setup" class="side-nav-link"><p><span class="orange">&lt&gt</span> Setup</p></a>
                            </li>
                            <li class="nav-item">
                                <a href="#results" class="side-nav-link"><p><span class="orange">&lt&gt</span> Results</p></a>
                            </li>
                        </ul>
                    </nav>
                </aside>
                <div class="main-content">
                    <div class="fluid-container scroller">
                        <div class="section" id="pathfinding">
                            <h1>Unity: Pathfinding Research</h1>
                            <hr>
                            <p>In depth research and comparison between different pathfinding strategies</p>
                            <p>Time: <span class="purple">Oct 2021</span></p>
                            <p>Duration: <span class="blue">Two months</span></p>
                            <p>Role: <span class="green">Developer</span></p>
                        </div>
                        <div class="row">
                            <div class="col-lg-7 col-xs-12 d-flex flex-column"> 
                                <div class="section" id="overview">
                                    <h2 class="sub-title">Overview</h2>
                                    <hr>
                                    <p>
                                        An experiment was done to compare the different strategies for plotting the shortest route between two points by a computer application. The three pathfinding strategies to find the shortest route was <span class="yellow">waypoint</span>, <span class="yellow">A*</span> and <span class="yellow">NavMesh</span>. The Unity game engine was used to create a virtual environment for this experiment. Agents/NPCs were presented in the environment to visualize the pathfinding strategies.
                                    </p>
                                </div>
                            </div>
                            <div class="col-lg-5 col-xs-12 ">
                                <div class="section">
                                    <h2 class="sub-title">Tech tools</h2>
                                    <hr>
                                    <div class="row">
                                        <div class="col d-flex align-items-stretch tech-img">
                                            <img src="static/img/unity.png" alt="Unity" width="200" height="200">
                                        </div>
                                        <div class="col d-flex align-items-stretch tech-img">
                                            <img src="static/img/c-sharp.png" alt="C Sharp" width="200" height="200">
                                        </div>
                                    </div>                 
                                </div>
                            </div>
                        </div>  
                        <div class="section" id="learning-points">
                            <h2 class="sub-title">Learning Points</h2>
                            <hr>    
                            <p><span class="red">&gt </span>Evaluate and analyze the pros and cons of different algorithms</p>
                            <p><span class="red">&gt </span>Development and implementation in a virtual enrivonement using Unity</p>
                            <p><span class="red">&gt </span>Extend standard pathfinding algorithms to handle complex environments not typically encountered in real-world simulations </p>
                        </div>
                        <div class="section" id="setup">
                            <h2 class="sub-title">Experiment Setup</h2>
                            <hr>
                            <div class="section">
                                <h3>01. NPCs/Agents</h3>
                                <p>Agents are imported from the <a href="https://assetstore.unity.com/packages/3d/props/polygon-starter-pack-low-poly-3d-art-by-synty-156819#content" class="green remove-link hover-link">"POLYGON Starter Pack - Low Poly 3D Art by Synty"<a> in Unity Asset Store. They are placed at the starting line and executes a different variation of pathfinding algorithm to seek for the target position when the game starts
                                </p>
                                <div class="video-container">
                                    <video autoplay loop muted playsinline>
                                        <source src="static/img/pathfinding/agents.mp4" type="video/mp4">
                                    </video>
                                </div>     
                            </div>
                            <div class="section">
                                <h3>02. Environment</h3>
                                <p>
                                    The environment I created is mainly a flat surface with a good amount of obstacles, making it challenging but able to accurately reflect the performance of each algorithms.
                                </p> 
                                <img src="static/img/pathfinding/environment.jpg" alt="environment" width="2800" height="1200" class="mb-5 mt-4">
                            </div>
                            <div class="section">
                                <h3>03. Performance Metric</h3>
                                <p>The performance metric used to compare & evaluate the different pathfinding algorithms was the number of frames it took for an agent to go from the start position to the target position. Unity engine runs the game at 60 frames per second which allowed me to easily calculate the total number of frames by multiplying the time (in seconds) by 60.</p>
                                <pre><code class="yellow">
void Update() {
    timer += Time.deltaTime;
    foreach (GameObject i in agents) { 
        if (Vector3.Distance(i.transform.position, target.transform.position) < 2) { 
            print(i.name);
            print(timer);
            agents.Remove(i);
        }
    }
}
                                </code></pre>
                            </div>
                            <div class="section">
                                <h3>04. Algorithms</h3>
                                <h3 class="mt-4"><span class="red">&gt&gt </span>Waypoint</h3>
                                <p>
                                    At the most basic level of AI pathfinding, my development of the main structure of wayfinding consists of only one script. The script takes in an array of already set waypoints and directs the agents towards the waypoints in the order they were added.
                                </p>
                                <pre><code class="yellow dm-mono">
if(Vector3.Distance(this.transform.position, waypoints[currentWP].transform.position) < 1) {
    if (tag == 0){
        currentWP++;
    }
    if (tag == 1){
        currentWP = currentWP - 1;
    }
}
// Change tag to 1 if the NCP reaches the end
if (currentWP >= waypoints.Length) {
    tag = 1;
    currentWP = currentWP - 1;
}
// Change tag to 0 if the NPC reaches the begining
if (currentWP <= 0) {
    tag = 0;
}
                                    </code></pre>
                                <h3 class="mt-4"><span class="red">&gt&gt </span>A*</h3>
                                <p>
                                    A* is a best-first search, meaning that it is formulated in terms of weighted graphs. Starting from a specific starting node of a graph, it aims to find a path to the given goal node having the smallest code. My implementation of A* follows the logic by maintaining a tree of paths originating at the start node and extending those paths one edge at a time until its termination criterion is satisfied.
                                </p>
                                <p>
                                    Specifically, A* selects the path that minimizes:
                                </p>
                                <pre class="mb-4"><code class="cacaca formula dm-mono">f(n) = g(n) + h(n)</code></pre>
                                <p>Where n is the next node on the path, g(n) is the cost of the path from the start node to n, and h(n) is a heuristic function that estimates the cost of the cheapest path from n to the goal.</p>
                                <pre><code class="yellow dm-mono">
while (openSet.Count > 0) {
    Node node = openSet[0];
    for (int i = 1; i < openSet.Count; i ++) {
        if (openSet[i].fCost < node.fCost || openSet[i].fCost == node.fCost) {
            if (openSet[i].hCost < node.hCost)
                node = openSet[i];
        }
    }
    openSet.Remove(node);
    closedSet.Add(node);
    if (node == targetNode) {
        
        pathSuccess = true;
        break;
    }
    foreach (Node neighbour in grid.GetNeighbours(node)) {
        if (!neighbour.walkable || closedSet.Contains(neighbour)) {
            continue;
        }
        int newCostToNeighbour = node.gCost + GetDistance(node, neighbour);
        if (newCostToNeighbour < neighbour.gCost || !openSet.Contains(neighbour)) {
            neighbour.gCost = newCostToNeighbour;
            neighbour.hCost = GetDistance(neighbour, targetNode);
            neighbour.parent = node;

            if (!openSet.Contains(neighbour))
                openSet.Add(neighbour);
        }
    }
}
                                </code></pre>
                                <h3 class="mt-4"><span class="red">&gt&gt </span>NavMesh</h3>
                                <p>My implementation of the NavMesh pathfinding utilizes a combination of Unity features and a simple script for the settings. The environment is baked with Unity and certain terrains are added with different costs to affect the pathing and movement speed of the agents, different terrain includes: mud, sand, ice, walls, and ceilings. The environment is also baked according to the agents' property (ex. Agent that has higher mass and can only go on ramps that are less steep compared to a lighter mass agent), creating a unique environment and pathing for different agents.</p>
                                <img src="static/img/pathfinding/baked_environment.jpg" alt="baked environment" width="2800" height="1200" class="mb-5 mt-4">
                                <p>My setting script contains adjustment to the agents pathfinding ability within the NavMesh system.</p>
                                <pre><code class="yellow dm-mono">
void Update() {
    NavMeshHit navHit;
    if (NavMesh.SamplePosition(transform.position, out navHit, 1f, NavMesh.AllAreas))
    {
        int mask1 = navHit.mask;
        int index = 0;
        while ((mask1 >>= 1) > 0)
        {
            index++;
        }
        float areaCost = NavMesh.GetAreaCost(index);
        int wallMask = 1 << NavMesh.GetAreaFromName("Wall");
        int ceilingMask = 1 << NavMesh.GetAreaFromName("Ceiling");
        agent.speed = basespeed - areaCost - rb.mass;
    }
    agent.SetDestination(target.transform.position);
}
                                </code></pre>
                            </div>
                            <div class="section" id="results">
                                <h2 class="sub-title">Results</h2>
                                <hr>

                            </div>
                        </div>
                    </div>      
                </div>
            </div>
        </main>
        <!-- Bootstrap v5.1 -->
        <!-- https://getbootstrap.com/docs/5.1/getting-started/introduction/ -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        
        <!-- Main.js -->
        <script src="static/js/main.js"></script>
    </body>
</html>